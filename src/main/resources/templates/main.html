<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ì¸ í™”ë©´</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main_style.css">
    <link rel="stylesheet" type="text/css" href="/css/navBar.css">
</head>
<body>
    <div class="wrapper-container mt-4">
        <header class="d-flex justify-content-between align-items-center mb-3" th:replace="~{layout/navBar :: headerLayout}">
<!--            <div ></div>-->
<!--            <h1>ë©”ì¸ í˜ì´ì§€</h1>-->

<!--            <span>ì•ˆë…•í•˜ì„¸ìš”, <span  >OOO</span>ë‹˜</span>-->

        </header>

        <!-- ê²€ìƒ‰ì°½ -->
        <div class="input-group mb-3 mt-3">
            <input type="text" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <button class="btn btn-primary">ğŸ” ê²€ìƒ‰</button>
        </div>

        <!-- ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ -->
		<div class="container position-relative">
		    <div class="row">
<!--				<div class="selectable-box col-12 col-sm-6 col-md-4 col-lg-2" th:each="box : ${boxes}" th:data-bid="${box.bid}">-->
<!--				    <div class="card">-->
<!--				        <div class="card-body">-->
<!--				            <h5 class="card-title text-primary" th:text="${box.name}">ë©”ë‰´ ì œëª©</h5>-->
<!--				            <p>ğŸ“…ëª¨ì„ ë‚ ì§œ: <span th:text="${#temporals.format(box.eventStartDate, 'yyyy-MM-dd')}"></span></p>-->
<!--				            <p>â³ìµœì¢… ì—…ë¡œë“œ: <span th:text="${#temporals.format(box.modifiedDate, 'yyyy-MM-dd')}"></span></p>-->
<!--				            <p>ğŸ”¥í­íŒŒ ë‚ ì§œ: <span th:text="${#temporals.format(box.boomDate, 'yyyy-MM-dd')}"></span></p>-->
<!--				        </div>-->
<!--				    </div>-->
<!--				    <button class="btn btn-danger deselect-btn" style="display: none;">ì„ íƒ í•´ì œ</button>-->
<!--				</div>-->
		    </div>
		</div>

		<!-- ë‹¤ìš´ë¡œë“œ / ì‚­ì œ ë²„íŠ¼ (ì²˜ìŒì—ëŠ” ìˆ¨ê¹€) -->
		<div id="action-buttons-container" style="display: none;">
		    <div class="d-flex justify-content-between mt-4">
		        <button id="download-btn" class="btn btn-primary">â¬‡</button>
		        <button id="delete-btn" class="btn btn-danger">ğŸ—‘</button>
		    </div>
		</div>
    </div>

	<button class="new-box-btn" onclick="window.location.href='/box'">+</button>
	
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom JS -->
    <script src="/js/main_script.js"></script>
    <script src="/js/auth.js"></script>

	<script>
		document.addEventListener("DOMContentLoaded", async function () {

            const token = sessionStorage.getItem("accessToken");
            if (!token) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                window.location.href="/login"
                return;
            }

            //
            try {
            // // ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const nickname = sessionStorage.getItem("nickname")
            document.querySelector(".nickname").innerHTML = `ì•ˆë…•í•˜ì„¸ìš”, <span style="color: black;">${nickname}</span>ë‹˜`;


                // ë°•ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const boxResponse = await fetch("/api/boxes", {
                method: "GET",
                headers: {
                "Authorization": `Bearer ${token}`,
                "Accept": "application/json"
                }
            });

            console.log("boxResponse: ",boxResponse)

            if (!boxResponse.ok) {
                throw new Error("Failed to fetch boxes");
            }

            const boxes = await boxResponse.json();
            console.log("boxes: ",boxes)
            await renderBoxes(boxes);

            } catch (error) {
            console.error("Error:", error);

            }
		});

		async function renderBoxes(boxes) {
            const container = document.querySelector(".row");
            container.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì‚­ì œ

            boxes.data.forEach(box => {
            const boxHTML = `
                <div class="selectable-box col-12 col-sm-6 col-md-4 col-lg-2" data-bid="${box.bid}">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title text-primary">${box.name}</h5>
                            <p>ğŸ“…ëª¨ì„ ë‚ ì§œ: ${box.eventStartDate}</p>
                            <p>â³ìµœì¢… ì—…ë¡œë“œ: ${box.modifiedDate}</p>
                            <p>ğŸ”¥í­íŒŒ ë‚ ì§œ: ${box.boomDate}</p>
                        </div>
                    </div>
                    <button class="btn btn-danger deselect-btn" style="display: none;">ì„ íƒ í•´ì œ</button>
                </div>
                `;
            container.innerHTML += boxHTML;
            });
		}
	</script>

</body>
</html>
